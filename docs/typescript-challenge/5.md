# TypeScript å¤§æŒ‘æˆ˜ï¼ˆäº”ï¼‰

è¿™æ˜¯ TypeScript å¤§æŒ‘æˆ˜ç³»åˆ—çš„ç¬¬ 5 ç¯‡ï¼Œç¬”è€…è®¡åˆ’ç”¨ 6 ä¸ªæœˆæ—¶é—´å®Œæˆ [type-challenges](https://github.com/type-challenges/type-challenges "type-challenges") é¡¹ç›®ä¸­çš„ 133 ä¸ªæŒ‘æˆ˜å¹¶è®°å½•ä¸‹è‡ªå·±çš„æ”¶è·ï¼Œç›®å‰è¿˜å‰©ä½™ 120 ä¸ªï¼Œæˆªæ­¢æ—¥æœŸä¸º 2023 å¹´ 1 æœˆ25 æ—¥ã€‚

![æŒ‘æˆ˜è¿›åº¦](./public/4-progress.png)

## 14. è·å–å‡½æ•°è¿”å›ç±»å‹

### æŒ‘æˆ˜å†…å®¹

å®ç° TypeScript å†…ç½®çš„ `ReturnType<T>`ï¼Œç”¨äºè·å–å‡½æ•°è¿”å›ç»“æœçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š

``` typescript
// TODO: å®ç° MyReturnType
type MyReturnType<T> = any

const fn = (v: boolean) => {
  if (v)
    return 1
  else
    return 2
}

//  A ç±»å‹ä¸º "1 | 2"
type A = MyReturnType<typeof fn>
```

> çŸ¥è¯†ç‚¹ï¼š`infer`

### é¢˜ç›®è§£æ

è™½ç„¶è¯´è¿™æ˜¯ medium éš¾åº¦çš„ç¬¬ä¸€é¢˜ï¼Œä½†æ˜¯å…¶å®å’Œ TypeScript å¤§æŒ‘æˆ˜ï¼ˆå››ï¼‰ä¸­ easy éš¾åº¦çš„æœ€åä¸€é¢˜ `13. Parameters` åŸºæœ¬ä¸€è‡´ï¼Œæ€è·¯ä¹Ÿæ˜¯é€šè¿‡ä½¿ç”¨ `infer`ï¼Œå®ç°è‡ªåŠ¨æ¨æ–­å‡ºç±»å‹çš„èƒ½åŠ›ã€‚

### é¢˜ç›®ç­”æ¡ˆ

``` typescript
type MyReturnType<T>
  = T extends (...args: any) => infer K
    ? K : never
```

## 15. å®ç° Omit

### æŒ‘æˆ˜å†…å®¹

å®ç° TypeScript å†…ç½®çš„ `Omit<T, K>` æ³›å‹ã€‚

`Omit` ä¼šåˆ›å»ºä¸€ä¸ªçœç•¥ `K` ä¸­å­—æ®µçš„ `T` å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š

``` typescript
// TODO: å®ç° MyOmit
type MyOmit<T, K> = any

interface Todo {
  title: string
  description: string
  completed: boolean
}

// TodoPreview: { completed: boolean }
type TodoPreview = MyOmit<
  Todo,
  'description' | 'title'
>
```

> çŸ¥è¯†ç‚¹ï¼š `in / keyof / infer`

### é¢˜ç›®è§£æ

è¿™é“é¢˜çš„å…³é”®åœ¨äºå¦‚ä½•å¾—åˆ° `T` æ‰€æœ‰å­—æ®µå‡å» `K` ä¸­å­—æ®µçš„ç»“æœï¼Œè€Œè¿™ä¸ªåŠŸèƒ½æ°æ°æ˜¯æˆ‘ä»¬åœ¨ TypeScript å¤§æŒ‘æˆ˜ï¼ˆäºŒï¼‰ä¸­æ‰€å®ç°çš„ `6. Exclude`ï¼š

``` typescript
// Result ä¸º 'b' | 'c'
type Result = Exclude<
  'a' | 'b' | 'c' | 'd', 
  'a' | 'd'
>
```

é€šè¿‡ `keyof T` è·å–åˆ° `T` çš„æ‰€æœ‰å­—æ®µï¼Œå†é€šè¿‡ `Exclude<keyof T, K>` æ—¢å¯ä»¥å¾—åˆ°æƒ³è¦çš„å­—æ®µã€‚

### é¢˜ç›®ç­”æ¡ˆ

``` typescript
type MyOmit<T, K extends keyof T> = {
  [P in Exclude<keyof T, K>]: T[P]
}
```

## 16. Readonly 2

### æŒ‘æˆ˜å†…å®¹

å®ç°ä¸€ä¸ªé€šç”¨ `MyReadonly2<T, K>`ï¼Œå®ƒå¸¦æœ‰ä¸¤ç§ç±»å‹çš„å‚æ•° `T` å’Œ `K`ï¼š
  - è‹¥æŒ‡å®š `K`ï¼Œåˆ™è®¾ç½® `T` å¯¹åº”çš„å±æ€§é›†ä¸º readonlyã€‚
  - è‹¥æœªæŒ‡å®š `K`ï¼Œåˆ™åº”ä½¿ `T` æ‰€æœ‰å±æ€§éƒ½å˜ä¸º readonlyã€‚

``` typescript
// TODO: å®ç° MyReadonly2
type MyReadonly2<T, K> = any

interface Todo {
  title: string
  description: string
  completed: boolean
}

const todo: MyReadonly2<Todo, 'title' | 'description'> = {
  title: "Hey",
  description: "foobar",
  completed: false,
}

// é”™è¯¯ï¼Œä¸èƒ½ä¿®æ”¹åªè¯»çš„ titile
todo.title = "Hello"
// é”™è¯¯ï¼Œä¸èƒ½ä¿®æ”¹åªè¯»çš„ description
todo.description = "barFoo"
// æ²¡é—®é¢˜
todo.completed = true
```

> çŸ¥è¯†ç‚¹ï¼š`keyof / èŒƒå‹é»˜è®¤å€¼ / Omit`

### é¢˜ç›®è§£æ

åœ¨ `K` æ²¡æœ‰ä¼ å€¼çš„æ—¶å€™ï¼Œéœ€è¦å°† `T` æ‰€æœ‰å±æ€§éƒ½å˜ä¸º readonlyï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦ç»™ `K` ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿™ç‚¹æ˜¯æˆ‘ä»¬ä¹‹å‰æ²¡æœ‰è§¦è¿‡çš„ã€‚

ä¸ºäº†ç»™èŒƒå‹ä¸€ä¸ªé»˜è®¤å€¼ï¼Œéœ€è¦ä½¿ç”¨ `K extends xxx = yyy` çš„å½¢å¼ï¼Œå…¶ä¸­ `yyy` å³ä¸ºé»˜è®¤å€¼ï¼š

``` typescript
// è®¾ç½® K çš„é»˜è®¤å€¼ä¸º T çš„æ‰€æœ‰å±æ€§
type MyReadonly2<
  T,
  K extends keyof T = keyof T
> = ...
```

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°† `T` çš„å±æ€§åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šåœ¨ `K` ä¸­çš„å±æ€§è®¾ç½®ä¸º readonlyï¼Œä¸åœ¨ `K` ä¸­çš„å±æ€§ä¿æŒåŸæ ·ï¼š

``` typescript
// K ä¸­çš„å±æ€§è®¾ç½®ä¸º readonly
type A<
  T,
  K extends keyof T = keyof T
> = {
  readonly [Key in K]: T[K]
}

// ä¸åœ¨ K ä¸­çš„å±æ€§ä¿æŒåŸæ ·
type B<
  T,
  K extends keyof T = keyof T
> = Omit<A, K>
```

æœ€åå°† `A` å’Œ `B` ç±»å‹é€šè¿‡ `&` ç»„è£…èµ·æ¥å³å¯ã€‚

### é¢˜ç›®ç­”æ¡ˆ

``` typescript
type MyReadonly2<
  T,
  K extends keyof T = keyof T
> = {
  readonly [Key in K]: T[Key]
} & Omit<T, K>
```

## 17. æ·±åº¦ Readonly

### æŒ‘æˆ˜å†…å®¹

å®ç°ä¸€ä¸ªé€šç”¨çš„ `DeepReadonly<T>`ï¼Œå®ƒå°†å¯¹è±¡çš„æ¯ä¸ªå‚æ•°åŠå…¶å­å¯¹è±¡é€’å½’åœ°è®¾ä¸º readonlyï¼Œä¾‹å¦‚ï¼š
  
``` typescript
// TODO: å®ç° DeepReadonly
type DeepReadonly<T> = any

type X = {
  x: { 
    a: 1
    b: 'hi'
  }
  y: 'hey'
}

type Expected = { 
  readonly x: { 
    readonly a: 1
    readonly b: 'hi'
  }
  readonly y: 'hey' 
}

// Todo çš„ç±»å‹å’Œ Expected ä¸€æ ·
type Todo = DeepReadonly<X>
```

> çŸ¥è¯†ç‚¹ï¼šé€’å½’è°ƒç”¨ / å‡½æ•°åˆ¤æ–­

### é¢˜ç›®è§£æ

å¯¹äºè¿™ç§åµŒå¥—ç±»å‹çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ TypeScript å¤§æŒ‘æˆ˜ï¼ˆä¸‰ï¼‰ `7.Awaited` ä¸­å·²ç»æ¥è§¦è¿‡ï¼Œä¸»è¦æ˜¯é€šè¿‡é€’å½’è°ƒç”¨çš„æ–¹å¼æ¥å¤„ç†ã€‚

é¦–å…ˆæ­å»ºåŸºæœ¬çš„æ¡†æ¶ï¼š

``` typescript
type DeepReadonly<T> = {
  readonly [K in keyof T]:
    (åˆ¤æ–­æ¡ä»¶) ? DeepReadonly<T[K]> : T[K]
}
```

æ¥ä¸‹æ¥çš„å…³é”®åˆ™æ˜¯åˆ¤æ–­æ¡ä»¶çš„ç¡®å®šï¼šå¯¹äºå¯¹è±¡ï¼Œéœ€è¦é€’å½’è°ƒç”¨ `DeepReadonly` è¿›è¡Œè®¡ç®—ï¼›å¯¹äºæ™®é€šæ•°æ®ç±»å‹ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

``` typescript
type DeepReadonly<T> = {
  readonly [K in keyof T]:
    K extends {} ? DeepReadonly<T[K]> : T[K]
}
```

ä¸è¿‡è¿™ä¸ªç­”æ¡ˆè¿˜ä¸ç®—å®Œç¾ï¼š`T[K]` ä¸ºå‡½æ•°æ—¶å…¶å®ä¸éœ€è¦å†è°ƒç”¨ `DeepReadonly` äº†ï¼Œæ‰€ä»¥å¯ä»¥å†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

``` typescript
type DeepReadonly<T> = {
  readonly [K in keyof T]:
    T[K] extends Function ? T[K]
      : K extends {} ? DeepReadonly<T[K]>
        : T[K]
}
```

### é¢˜ç›®ç­”æ¡ˆ

``` typescript
type DeepReadonly<T> = {
  readonly [K in keyof T]:
    T[K] extends Function ? T[K]
      : K extends {} ? DeepReadonly<T[K]>
        : T[K]
}
```

é™¤äº†è¿™ç§æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ `keyof T extends never` çš„æ–¹å¼æ¥è¿‡æ»¤å‡½æ•°ï¼Œå¯¹äºå‡½æ•°è€Œè¨€ï¼Œè¿™ä¸ªåˆ¤æ–­æ¡ä»¶çš„ç»“æœä¸º falseï¼š

``` typescript
type DeepReadonly<T> =
  keyof T extends never ? T : {
      readonly [key in keyof T]:
        DeepReadonly<T[key]>
  }
```

## ç»“è¯­

å’Œ easy éš¾åº¦çš„æŒ‘æˆ˜ç›¸æ¯”ï¼Œmedium éš¾åº¦çš„é¢˜ç›®æ˜æ˜¾æ›´åŠ çµæ´»äº†ï¼Œæœ‰æ—¶å€™è¿˜éœ€è¦å€ŸåŠ© TypeScript å†…ç½®çš„å·¥å…·ç±»å‹æ¥å·§å¦™åœ°è§£å†³é—®é¢˜ï¼Œæœ‰æ„æ€ ğŸ˜›